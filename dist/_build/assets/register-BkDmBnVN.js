import{a as x,b as S,c as y,r as l,d as b,e as j,j as s,F as i,V as I,C as T,f as F,W as w,g as V,D,h as A,U as C,i as N,v as z,p as u}from"./client-D0JzVCqi.js";const O=function(){const r=x(),{toast:t}=S(),m=y(),[P,d]=l.useState(0),[c,h]=l.useState(!1),n=b({resolver:j(z),defaultValues:{brand:"",model:"",year:new Date().getFullYear(),trim:"",vehicleType:"",color:"",status:"available",condition:"new",images:[],description:"",transmission:"",fuelType:"",engineSize:"",plate:"",vin:"",mileage:0,doors:4,seats:5,price:"",hasOffer:!1,offerPrice:"",adminStatus:"",inMaintenance:!1,entryDate:new Date().toISOString(),clientId:"",clientName:"",contractId:"",concesionarioId:""},mode:"onChange"}),p=e=>{const g=(e.images||[]).filter(o=>o instanceof File&&o.size>0),v={brand:e.brand,model:e.model,year:e.year,trim:e.trim||void 0,vehicleType:e.vehicleType,color:e.color,status:e.status,condition:e.condition,images:g,description:e.description||void 0,transmission:e.transmission,fuelType:e.fuelType,engineSize:e.engineSize,plate:e.plate||void 0,vin:e.vin,mileage:e.mileage||null,doors:e.doors,seats:e.seats,price:u(e.price),hasOffer:e.hasOffer,offerPrice:e.offerPrice?u(e.offerPrice):null,adminStatus:e.adminStatus||void 0,inMaintenance:e.inMaintenance,entryDate:e.entryDate||null,concesionarioId:e.concesionarioId||void 0};m.mutate(v,{onSuccess:o=>{let a="Vehículo registrado exitosamente.";e.concesionarioId&&(a+=" Asignado al concesionario seleccionado."),t({title:"¡Éxito!",description:a,variant:"success"}),setTimeout(()=>{c?(n.reset(),d(0)):e.clientId&&e.contractId?r.navigate({to:"/contracts/$contractId",params:{contractId:e.contractId}}):r.navigate({to:"/vehicles"})},1500)},onError:o=>{console.error("Error creating vehicle:",o),t({title:"Error",description:o.message||"Error al registrar el vehículo. Por favor, inténtalo de nuevo.",variant:"destructive"})}})},f=[{id:"general-info",label:"Datos basicos",icon:s.jsx(T,{className:"h-4 w-4"}),component:s.jsx(i,{...n,children:s.jsx(I,{form:n})}),validate:async()=>await n.trigger(["brand","model","year","vehicleType","color","status","condition"],{shouldFocus:!0})},{id:"technical-specs",label:"Detalles tecnicos",icon:s.jsx(w,{className:"h-4 w-4"}),component:s.jsx(i,{...n,children:s.jsx(F,{form:n})}),validate:async()=>await n.trigger(["transmission","fuelType","engineSize","vin","doors","seats"],{shouldFocus:!0})},{id:"financial-admin",label:"Informacion financiera",icon:s.jsx(D,{className:"h-4 w-4"}),component:s.jsx(i,{...n,children:s.jsx(V,{form:n})}),validate:async()=>await n.trigger(["price","entryDate"],{shouldFocus:!0})},{id:"associations",label:"Asociaciones (opcional)",icon:s.jsx(C,{className:"h-4 w-4"}),optional:!0,component:s.jsx(i,{...n,children:s.jsx(A,{form:n,onAddAnother:e=>h(e),addAnother:c})})}];return s.jsxs("div",{className:"container py-8 animate-in fade-in-50 duration-500",children:[s.jsx("h1",{className:"text-3xl font-bold tracking-tight mb-6",children:"Agregar Nuevo Vehículo"}),s.jsx(N,{steps:f,onComplete:n.handleSubmit(p),cancelHref:"/vehicles",completeText:"Guardar Vehículo",nextText:"Continuar",backText:"Anterior",cancelText:"Cancelar",showStepSummary:!1,autoSave:!0,className:"shadow-lg border-0 rounded-xl overflow-hidden"})]})};export{O as component};
